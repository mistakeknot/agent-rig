{"id":"agent-rig-2as","title":"Track upstream changes and assist rig curation","description":"Rig authors need to stay current with upstream plugin/tool changes and make informed decisions about what to adopt. This is the 'curated upstream sync' problem — not blind merging, but assisted reasoning about what changed and whether it fits the rig's purpose.\n\n## Two sub-problems\n\n### A. Upstream change detection\n- A rig declares plugins, MCP servers, and tools from external sources\n- Those sources evolve independently (new versions, new skills, breaking changes, deprecations)\n- agent-rig should be able to check what changed upstream since the rig was last updated\n- Command: agent-rig upstream-check — shows changelog/diff per dependency\n\n### B. Upstream curation assistance\n- When upstream changes are detected, help the rig author reason through them:\n  - Does this new capability overlap with something already in the rig?\n  - Does it conflict with the rig's philosophy or scope? (e.g. Clavain is general-purpose only)\n  - Does it introduce new dependencies?\n  - Should it go in required, recommended, or infrastructure?\n  - Does it affect the conflict list? (new upstream skill might duplicate a declared conflict)\n- This is inherently an agent-assisted workflow — present the changes, ask questions, update the manifest\n\n## What to build\n\n### agent-rig upstream command family\n- agent-rig upstream check — scan all declared sources for newer versions, summarize changes\n- agent-rig upstream diff \u003csource\u003e — show detailed diff for one upstream source\n- agent-rig upstream adopt \u003csource\u003e — interactive flow to selectively adopt changes into the rig manifest\n\n### Upstream metadata in agent-rig.json\n- Add optional upstream tracking to the schema:\n  - plugins could track pinned versions vs latest\n  - tools could track installed version vs latest available\n  - Record last-synced commit/version per source\n\n### Curation heuristics\n- Compare new upstream skills/agents against existing rig skills for overlap\n- Check new upstream dependencies against rig conflict list\n- Flag capabilities that fall outside the rig's declared keywords/scope\n- Suggest categorization (required vs recommended) based on what the rig already has\n\n## Real-world example\nClavain already has upstreams.json and scripts/pull-upstreams.sh for manual upstream sync. This feature would replace that manual workflow with an integrated, rig-aware process.\n\n## Acceptance criteria\n- agent-rig upstream check reports what changed across all declared sources\n- agent-rig upstream diff shows detailed changes for a specific source\n- agent-rig upstream adopt walks through changes interactively\n- Rig manifest updated correctly after adoption\n- Rig's scope/philosophy respected during suggestions (via keywords, description, existing patterns)","status":"closed","priority":2,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:04:16.350318774-08:00","created_by":"mk","updated_at":"2026-02-11T07:36:15.497157637-08:00","closed_at":"2026-02-11T07:36:15.497157637-08:00","close_reason":"Closed"}
{"id":"agent-rig-2xd","title":"Merge behavioral config intelligently","description":"agent-rig currently copies behavioral files (CLAUDE.md) and prepends a pointer to the project's root CLAUDE.md. If the user has edited the installed behavioral file, re-install overwrites their changes silently. There's no merge strategy.\n\n## What to do\n- Before overwriting a behavioral file, check if it was modified since install (compare against stored hash in install-manifest.json)\n- If modified, offer choices: overwrite, skip, diff, merge\n- For CLAUDE.md pointers: check if the pointer line still exists before re-adding\n- Consider using a 3-way merge (original installed version, user's version, new rig version)\n\n## Acceptance criteria\n- Modified behavioral files are not silently overwritten\n- User shown a diff when conflicts exist\n- Clean re-installs (no user edits) proceed without prompting","status":"open","priority":3,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:02:05.517983275-08:00","created_by":"mk","updated_at":"2026-02-10T22:02:05.517983275-08:00"}
{"id":"agent-rig-5bb","title":"Resolve transitive plugin dependencies","description":"agent-rig installs the plugins listed in the manifest but doesn't resolve their dependencies. If plugin A depends on plugin B, and the rig only lists A, plugin B won't be installed.\n\n## What to do\n- When installing plugins, check if each plugin has its own dependencies (via plugin.json or marketplace metadata)\n- Auto-install transitive dependencies\n- Detect dependency conflicts (plugin A needs context7 v2 but plugin B needs context7 v1)\n- Show the full resolved dependency tree in the install plan\n\n## Open questions\n- Does Claude Code's plugin install already handle transitive deps? If so, this may be a no-op.\n- How to discover plugin dependencies — marketplace API? plugin.json in the plugin repo?\n\n## Acceptance criteria\n- Transitive dependencies are discovered and installed\n- Dependency conflicts are reported before install\n- Install plan shows the full dependency tree","status":"closed","priority":2,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:01:26.254867978-08:00","created_by":"mk","updated_at":"2026-02-11T07:35:13.61658015-08:00","closed_at":"2026-02-11T07:35:13.61658015-08:00","close_reason":"Closed"}
{"id":"agent-rig-a9o","title":"Detect unknown plugin conflicts automatically","description":"agent-rig disables conflicts explicitly listed in the manifest but doesn't detect unknown conflicts. If a user already has a plugin installed that conflicts with a rig plugin, no warning is shown.\n\n## What to do\n- Before install, scan currently installed plugins\n- Cross-reference against known conflict metadata (from marketplace or plugin.json)\n- Warn about plugins not in the rig's conflict list that may overlap\n- Optionally: plugins could declare their own conflicts in plugin.json, and agent-rig reads those\n\n## Open questions\n- Where does conflict metadata live? In plugin.json? In the marketplace?\n- Should this be heuristic (keyword overlap) or explicit (declared conflicts only)?\n\n## Acceptance criteria\n- Pre-install scan warns about potential undeclared conflicts\n- User can choose to proceed or abort\n- Detected conflicts shown in install plan","status":"closed","priority":2,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:01:37.956320256-08:00","created_by":"mk","updated_at":"2026-02-11T07:34:27.31853634-08:00","closed_at":"2026-02-11T07:34:27.31853634-08:00","close_reason":"Closed"}
{"id":"agent-rig-cee","title":"Write MCP server config during install","description":"agent-rig install declares MCP servers in the manifest but never writes them to .mcp.json or Claude Code's MCP config. Users must manually configure MCP servers after install, which breaks the autonomous install promise.\n\n## What to do\n- During install, write MCP server entries from the rig manifest into the appropriate config file\n- For Claude Code: write to .mcp.json in the project root (or global config)\n- For Codex: write to whatever Codex uses for MCP config\n- Handle idempotency — don't duplicate entries that already exist\n- Handle merge — if .mcp.json already has a server with the same name, warn or skip\n\n## Acceptance criteria\n- After agent-rig install, all declared MCP servers are configured and ready to use\n- No manual MCP configuration needed\n- Existing .mcp.json entries are preserved\n- Dry run shows what would be written","status":"closed","priority":1,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:00:56.593960756-08:00","created_by":"mk","updated_at":"2026-02-11T00:02:26.811817237-08:00","closed_at":"2026-02-11T00:02:26.811817237-08:00","close_reason":"Added installMcpServers() to PlatformAdapter interface, implemented in ClaudeCodeAdapter using claude mcp add CLI (handles http/stdio/sse types, user scope, idempotent via claude mcp get check), no-op in CodexAdapter, wired into install command. Build passes, all tests pass, dry-run shows MCP servers in install plan."}
{"id":"agent-rig-n1s","title":"Track installed state and support uninstall","description":"agent-rig has no record of what's installed. There's no state file, no uninstall command, and no way to diff current state vs a new rig version. The behavioral installer writes install-manifest.json per rig but nothing reads it.\n\n## What to do\n- Create a state file (e.g. ~/.agent-rig/state.json) that records:\n  - Which rig is installed (name, version, source)\n  - Which plugins were installed by the rig\n  - Which conflicts were disabled\n  - Which MCP servers were configured\n  - Which behavioral files were written\n  - Timestamp of install\n- Add agent-rig uninstall command that reverses the install:\n  - Remove plugins installed by the rig (not ones that were already there)\n  - Re-enable disabled conflicts\n  - Remove MCP server entries added by the rig\n  - Remove behavioral files and pointers\n- Add agent-rig status command that shows current installed rig(s)\n\n## Acceptance criteria\n- State file written on every install\n- agent-rig uninstall reverses a clean install\n- agent-rig status shows what's installed\n- Uninstall only removes things the rig added, not pre-existing config","status":"closed","priority":1,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:01:06.763594618-08:00","created_by":"mk","updated_at":"2026-02-11T00:05:28.597165212-08:00","closed_at":"2026-02-11T00:05:28.597165212-08:00","close_reason":"Added state tracking module (src/state.ts) storing installed rig state in ~/.agent-rig/state.json. Install command now records all installed plugins, disabled conflicts, MCP servers, behavioral files, and marketplaces. Added agent-rig status command to show installed rigs. Added agent-rig uninstall command that reverses install (removes plugins, re-enables conflicts, removes MCP servers, cleans up behavioral files and pointers). Build passes, all tests pass."}
{"id":"agent-rig-ofw","title":"Write environment variables to shell profile during install","description":"agent-rig install currently prints 'add these to your shell profile' for env vars but doesn't actually write them. For tools like Oracle that need DISPLAY=:99, this means the rig isn't truly autonomous.\n\n## What to do\n- Detect the user's shell (bash/zsh/fish)\n- Append env vars to the appropriate profile file (~/.bashrc, ~/.zshrc, etc.)\n- Use a tagged block so they can be identified and removed:\n  # --- agent-rig: clavain ---\n  export DISPLAY=\":99\"\n  export CHROME_PATH=\"/usr/local/bin/google-chrome-wrapper\"\n  # --- end agent-rig: clavain ---\n- Idempotent — don't duplicate if block already exists\n- Uninstall removes the block\n\n## Risks\n- Writing to shell profiles is invasive — should require explicit confirmation\n- Fish shell uses a different syntax (set -gx vs export)\n- Some users use .profile, some .bash_profile, some .bashrc\n\n## Acceptance criteria\n- Env vars written to shell profile with tagged block\n- Re-install doesn't duplicate\n- Uninstall removes the block\n- User prompted before writing (not --yes skippable? or is it?)","status":"open","priority":3,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:01:54.522114136-08:00","created_by":"mk","updated_at":"2026-02-10T22:01:54.522114136-08:00"}
{"id":"agent-rig-sdr","title":"Make Clavain the first installable rig","description":"Make Clavain (at ../Clavain) the first real rig installable via agent-rig (this repo).\n\n## Context\n- agent-rig is at /root/projects/agent-rig\n- Clavain is at /root/projects/Clavain\n- Clavain is both a Claude Code plugin (.claude-plugin/plugin.json) AND has an agent-rig.json manifest\n- The agent-rig.json is stale (v0.4.18) while plugin.json is at v0.4.25\n- Plugin lists (required/recommended/infrastructure) have drifted between the two files\n\n## Steps\n\n### 1. Sync agent-rig.json in Clavain\n- Update version to match plugin.json (currently 0.4.25)\n- Reconcile plugin categorizations (required vs recommended vs infrastructure) — plugin.json is authoritative for what Clavain declares as MCP servers, agent-rig.json is authoritative for the rig layers (plugins, tools, env, behavioral)\n- Update description to match current counts\n- Validate result: node dist/index.js validate /root/projects/Clavain\n\n### 2. Add agent-rig.json to bump-version.sh in Clavain\n- File: /root/projects/Clavain/scripts/bump-version.sh\n- Currently bumps plugin.json version — add agent-rig.json so they never drift again\n- The version field in agent-rig.json should be updated the same way as plugin.json\n\n### 3. Test agent-rig install against live Clavain\n- Build agent-rig: cd /root/projects/agent-rig \u0026\u0026 pnpm build\n- Dry run: node dist/index.js install --dry-run /root/projects/Clavain\n- Verify: no errors, install plan shows all expected components\n- Do NOT run a real install (would modify the host system)\n\n### 4. Update examples/clavain in agent-rig\n- Copy the updated agent-rig.json from Clavain to examples/clavain/agent-rig.json in this repo\n- These should be identical\n\n## Done when\n- agent-rig validate passes on Clavain's agent-rig.json\n- agent-rig install --dry-run shows a correct install plan\n- bump-version.sh updates both files\n- examples/clavain matches the live Clavain manifest\n- All changes committed to main in both repos\n","status":"closed","priority":1,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T20:56:07.509208015-08:00","created_by":"mk","updated_at":"2026-02-11T00:06:54.254742436-08:00","closed_at":"2026-02-11T00:06:54.254742436-08:00","close_reason":"Synced Clavain agent-rig.json to v0.4.27 (matching plugin.json), updated description counts and keywords. Added agent-rig.json to bump-version.sh so versions stay in sync. Dry-run install passes cleanly showing all 15 plugins, 8 conflicts, 2 MCP servers, 4 tools, behavioral config. Updated examples/clavain to match. Both repos ready for commit."}
{"id":"agent-rig-t0u","title":"Add agent-rig update command","description":"No way to update an installed rig to a newer version. Users must manually re-run install and hope for idempotency.\n\n## What to do\n- Add agent-rig update [source] command that:\n  - Reads current installed state\n  - Fetches the latest rig manifest from the source\n  - Diffs installed vs latest (new plugins, removed plugins, changed versions, new MCP servers, etc.)\n  - Shows the diff to the user\n  - Applies the diff (install new, remove old, update changed)\n- Add agent-rig outdated command that checks if a newer version exists without applying changes\n\n## Dependencies\n- Requires installed state tracking (agent-rig-n1s)\n\n## Acceptance criteria\n- agent-rig update shows what changed and applies updates\n- agent-rig outdated reports version differences\n- Update handles added/removed plugins, MCP servers, tools\n- Dry run support","status":"closed","priority":2,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:01:15.775811226-08:00","created_by":"mk","updated_at":"2026-02-11T07:33:16.66864818-08:00","closed_at":"2026-02-11T07:33:16.66864818-08:00","close_reason":"Closed","labels":["depends:agent-rig-n1s"]}
{"id":"agent-rig-w59","title":"Idempotent re-install with full state awareness","description":"Re-running agent-rig install on an already-installed rig should be a clean no-op or upgrade, not a blind re-application. Currently plugins skip if already installed, but there's no holistic state comparison.\n\n## What to do\n- On install, if a rig is already installed (per state file), compare versions\n- Same version: report 'already installed, nothing to do' (or --force to re-apply)\n- Newer version: delegate to update flow\n- Different rig: warn about replacing, show what will change\n- Handle partial installs gracefully (e.g. previous install failed halfway)\n\n## Dependencies\n- Requires installed state tracking (agent-rig-n1s)\n\n## Acceptance criteria\n- Re-install of same version is a no-op\n- Re-install of newer version triggers update\n- Partial install state is detected and can be repaired","status":"closed","priority":2,"issue_type":"task","owner":"mistakeknot@users.noreply.github.com","created_at":"2026-02-10T22:02:16.444585391-08:00","created_by":"mk","updated_at":"2026-02-11T07:33:16.679425543-08:00","closed_at":"2026-02-11T07:33:16.679425543-08:00","close_reason":"Closed","labels":["depends:agent-rig-n1s"]}
